{% extends "components/base.html" %}
{% load static %}

{% block content %}
<link rel="stylesheet" href="{% static 'Authentication/css/usuarios.css' %}">

{% if messages %}
  <div class="alertas">
    {% for message in messages %}
      <div class="alerta-mensaje 
        {% if message.tags == 'success' %}success-message{% endif %}
        {% if message.tags == 'error' %}error-message{% endif %}">
        <p>{{ message }}</p>
      </div>
    {% endfor %}
  </div>
{% endif %}


<div class="p-6">
  <div class="flex justify-between items-center mb-4">
    <h1 class="text-2xl font-semibold text-gray-900">Gestión de Usuarios</h1>
    <button id="new-user-button" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">
      <i class="fas fa-user-plus mr-2"></i> Nuevo Usuario
    </button>
  </div>

  <div class="bg-white rounded-lg shadow overflow-x-auto mx-auto max-w-3xl">
    <table class="min-w-full table-auto text-sm text-left text-gray-500">
      <thead class="text-xs text-gray-700 uppercase bg-gray-50">
        <tr>
          <th class="px-6 py-3">Nombre</th>
          <th class="px-6 py-3">Correo</th>
          <th class="px-6 py-3">Rol</th>
          <th class="px-6 py-3">Acciones</th>
        </tr>
      </thead>
      <tbody>
        {% for usuario in usuarios %}
        <tr class="bg-white border-b hover:bg-gray-50">
          <td class="px-6 py-4 font-medium text-gray-900">{{ usuario.nombre }}</td>
          <td class="px-6 py-4">{{ usuario.correo }}</td>
          <td class="px-6 py-4">
            {% if usuario.rol == "Administrador" %}
              <span class="bg-blue-100 text-blue-800 text-xs font-semibold px-3 py-1 rounded-2xl">Administrador</span>
            {% elif usuario.rol == "Docente" %}
              <span class="bg-green-100 text-green-800 text-xs font-semibold px-3 py-1 rounded-2xl">Docente</span>
            {% elif usuario.rol == "Observador" %}
              <span class="bg-purple-100 text-purple-800 text-xs font-semibold px-3 py-1 rounded-2xl">Observador</span>
            {% else %}
              <span class="text-gray-700 text-xs font-medium">{{ usuario.rol }}</span>
            {% endif %}
          </td>
          
            <td class="px-6 py-4 flex space-x-2">
            <a href="{% url 'editar_usuario' usuario.id %}" class="text-blue-600 hover:underline" title="Editar">
              <i class="fas fa-edit"></i>
            </a>
            <a href="{% url 'eliminar_usuario' usuario.id %}" class="text-red-600 hover:underline" title="Eliminar">
              <i class="fas fa-trash-alt"></i>
            </a>
            <a href="{% url 'cambiar_clave_usuario' usuario.id %}" class="text-yellow-600 hover:underline" title="Cambiar Clave">
              <i class="fas fa-key"></i>
            </a>
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="6" class="px-6 py-4 text-center text-gray-500">No hay usuarios registrados.</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<!-- Modal para crear usuario -->
<div id="user-modal" class="fixed z-50 inset-0 overflow-y-auto hidden bg-black bg-opacity-50">
  <div class="flex items-center justify-center min-h-screen px-4">
    <div class="bg-white rounded-lg shadow-lg w-full max-w-md p-6 relative">
      <h2 class="text-xl font-bold mb-4">Nuevo Usuario</h2>
      <form id="user-form" method="POST" action="{% url 'crear_usuario' %}" class="space-y-4">
        {% csrf_token %}
        <div>
          <label for="username" class="block text-sm font-medium text-gray-700">Nombre</label>
          <input type="text" name="nombre" id="username" class="mt-1 block w-full border border-gray-300 rounded-md p-2" required>
        </div>
        <div>
          <label for="email" class="block text-sm font-medium text-gray-700">Correo</label>
          <input type="email" name="correo" id="email" class="mt-1 block w-full border border-gray-300 rounded-md p-2" required>
        </div>
        <div>
          <label for="rol" class="block text-sm font-medium text-gray-700">Rol</label>
          <select name="rol" id="rol" class="mt-1 block w-full border border-gray-300 rounded-md p-2" required>
            <option value="" disabled hidden selected>Selecciona un rol</option>
            <option value="Administrador">Administrador</option>
            <option value="Docente">Docente</option>
            <option value="Observador">Observador</option>
          </select>
        </div>
        <div class="flex justify-end space-x-2 pt-4">
          <button type="button" id="cancel-user-button" class="px-4 py-2 bg-gray-300 rounded-md">Cancelar</button>
          <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-md">Guardar</button>
        </div>
      </form>
      <button class="absolute top-2 right-2 text-gray-400 hover:text-gray-600" onclick="document.getElementById('user-modal').classList.add('hidden')">
        <i class="fas fa-times"></i>
      </button>
    </div>
  </div>
</div>

<script>
  document.getElementById('new-user-button').addEventListener('click', function () {
    document.getElementById('user-modal').classList.remove('hidden');
  });

  document.getElementById('cancel-user-button').addEventListener('click', function () {
    document.getElementById('user-modal').classList.add('hidden');
  });
  
  document.addEventListener('DOMContentLoaded', function() {
    // Mostrar los mensajes de éxito o error
    if (document.querySelector('.success-message')) {
      document.querySelector('.success-message').style.display = 'block';
    }
    if (document.querySelector('.error-message')) {
      document.querySelector('.error-message').style.display = 'block';
    }

    // Hacer que los mensajes desaparezcan después de 5 segundos
    setTimeout(function() {
      const mensajes = document.querySelectorAll('.alerta-mensaje');
      mensajes.forEach(function(mensaje) {
        mensaje.style.display = 'none';
      });
    }, 5000);  // 5000ms = 5 segundos
  });

</script>
{% endblock %}
